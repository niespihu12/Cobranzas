; ============================================================================
; VOICEBOT COBRANZAS - CONFIGURACIÓN ASTERISK
; Banco de Bogotá
; ============================================================================
;
; Archivos a configurar:
;   - /etc/asterisk/extensions.conf (o extensions_custom.conf)
;   - /etc/asterisk/manager.conf
;   - /etc/asterisk/pjsip.conf (trunk SIP)
;
; ============================================================================

; ============================================================================
; EXTENSIONS.CONF - Dialplan del Voicebot
; ============================================================================
; Agregar a /etc/asterisk/extensions.conf o crear extensions_voicebot.conf
; e incluirlo con: #include extensions_voicebot.conf

[voicebot-cobranzas]
; Contexto principal para llamadas del voicebot

; Llamada saliente - cuando el marcador origina la llamada
exten => s,1,NoOp(=== VOICEBOT COBRANZAS - INICIO ===)
 same => n,NoOp(Cliente: ${CLIENTE_NOMBRE})
 same => n,NoOp(Cédula: ${CLIENTE_CEDULA})
 same => n,NoOp(Teléfono: ${CLIENTE_CELULAR})
 same => n,Answer()
 same => n,Wait(1)
 same => n,AGI(/opt/voicebot/voicebot_agi.py)
 same => n,NoOp(Resultado: ${VOICEBOT_RESULTADO})
 same => n,NoOp(Monto: ${VOICEBOT_MONTO})
 same => n,Hangup()

; Extensión de prueba
exten => test,1,NoOp(=== VOICEBOT TEST ===)
 same => n,Answer()
 same => n,Playback(hello-world)
 same => n,Hangup()

; Handler de llamada no contestada
exten => s,100,NoOp(=== SIN CONTESTAR ===)
 same => n,Set(VOICEBOT_RESULTADO=SIN_CONTESTAR)
 same => n,Hangup()

; Handler de error
exten => h,1,NoOp(=== HANGUP ===)
 same => n,NoOp(Resultado final: ${VOICEBOT_RESULTADO})


; ============================================================================
; MANAGER.CONF - Configuración AMI para el marcador
; ============================================================================
; Agregar a /etc/asterisk/manager.conf

; [general]
; enabled = yes
; port = 5038
; bindaddr = 127.0.0.1
;
; [voicebot]
; secret = voicebot123
; deny = 0.0.0.0/0.0.0.0
; permit = 127.0.0.1/255.255.255.0
; read = system,call,log,verbose,command,agent,user,originate
; write = system,call,log,verbose,command,agent,user,originate


; ============================================================================
; PJSIP.CONF - Trunk SIP de ejemplo
; ============================================================================
; Agregar a /etc/asterisk/pjsip.conf
; NOTA: Ajustar según tu proveedor SIP

; [trunk-salida]
; type = endpoint
; transport = transport-udp
; context = from-trunk
; disallow = all
; allow = ulaw
; allow = alaw
; outbound_auth = trunk-auth
; aors = trunk-aor
;
; [trunk-auth]
; type = auth
; auth_type = userpass
; username = TU_USUARIO
; password = TU_PASSWORD
;
; [trunk-aor]
; type = aor
; contact = sip:TU_PROVEEDOR.com
;
; [trunk-identify]
; type = identify
; endpoint = trunk-salida
; match = IP_PROVEEDOR


; ============================================================================
; COMANDOS ÚTILES
; ============================================================================
;
; Verificar dialplan:
;   asterisk -rx "dialplan show voicebot-cobranzas"
;
; Verificar AMI:
;   asterisk -rx "manager show users"
;
; Ver canales activos:
;   asterisk -rx "core show channels"
;
; Recargar configuración:
;   asterisk -rx "dialplan reload"
;   asterisk -rx "manager reload"
;
; Hacer llamada de prueba:
;   asterisk -rx "channel originate PJSIP/trunk-salida/3001234567 extension test@voicebot-cobranzas"
;
; Ver logs en tiempo real:
;   asterisk -rvvvv
